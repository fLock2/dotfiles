---
- name: Machine setup
  hosts: localhost
  become: false
  connection: local
  gather_facts: true
  vars:
    flyctl_version: "0.1.130"
    pulumi_version: "v3.94.2"

  tasks:
    - name: Get my user
      ansible.builtin.set_fact:
        remote_regular_user: "{{ansible_user_id}}"

    - name: install homebrew formulae packages
      become: false
      homebrew:
        name:
          - btop
          - cmake
          - eza
          - fd
          - fzf
          - gcc
          - git
          - lazygit
          - libvterm
          - make
          - mas
          - mpv
          - neovim
          - nushell
          - ripgrep
          - starship
          - unzip
        update_homebrew: yes
        state: present

    - name: install homebrew cask packages
      become: false
      homebrew_cask:
        name:
          - arc
          - cheatsheet
          - discord
          - emacs
          - firefox
          - hiddenbar
          - iterm2
          - latest
          - mac-mouse-fix
          - nextcloud
          - obsidian
          - raycast
          - rectangle
          - shottr
          - zotero
        state: present

    - name: check if cargo is installed
      shell: command -v cargo
      register: cargo_exists
      ignore_errors: yes

    - name: Download Rustup
      when: cargo_exists is failed
      get_url:
        url: https://sh.rustup.rs
        dest: /tmp/sh.rustup.rs
        mode: "0755"
        force: "yes"
      tags:
        - rust

    - name: install rust/cargo
      when: cargo_exists is failed
      shell: /tmp/sh.rustup.rs -y
      tags:
        - rust

    - name: Install zoxide
      when:
      shell: cargo install --git https://github.com/ajeetdsouza/zoxide

    - name: install app store programs
      community.general.mas:
        id:
          - 975890633 # HotKey
          - 1352778147 # Bitwarden
          - 1355679052 # Dropover
          - 1451685025 # Wireguard
